#### 背景

在书中提到了缓存的伸缩性的研究。

分布式缓存的哈希算法，随着增加或者删减机器导致的缓存大量不可用而引发的查数据库导致的数据库顶不住压力而宕机的问题而产生的一致性哈希算法。



#### 简单hash

所谓的简单hash，即余数hash，计算缓存的key值的hash值，取现在的缓存服务器的个数的余数，选择缓存的存放机器。

如果不涉及增减机器，那么不会有问题。

现假设原来有三台机器，现增加一台机器。

那新增之后的缓存命中率变成多少了呢？

```text
假设新增前总量是N，服务器是X；
新增一台之后，我们发现，只有前X个是能正常找到的，其他都是会发生偏移。
X / N;
假设之前是7个数据，服务器是三个，新增一个之后，命中的概率是 3/7.如果是100w数据，那命中概率就是3/100w;
```



####   一致性hash

- k台机器
- 数据hash值的范围是[0,MAX];
- 把hash值的范围划分成m个分区
- m>>k
- 每台机器负责处理m/k个数据

当新增一台机器的时候，我们会让每台机器处理 m /k+1 这样缓解了每台服务器的缓存压力。

